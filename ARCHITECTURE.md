# üèóÔ∏è Documenta√ß√£o T√©cnica de Arquitetura - Text Processing API (COM JWT)

## üìã **Vis√£o Geral**

Este documento descreve detalhadamente a arquitetura, padr√µes de projeto e decis√µes t√©cnicas implementadas na Text Processing API, incluindo a nova camada de seguran√ßa JWT. √â uma documenta√ß√£o interna para desenvolvedores e arquitetos.

**‚ö†Ô∏è IMPORTANTE**: Este arquivo cont√©m informa√ß√µes t√©cnicas detalhadas e n√£o deve ser commitado no reposit√≥rio p√∫blico.

---

## üéØ **Arquitetura Geral**

### **1.1 Padr√£o Arquitetural**

A aplica√ß√£o segue uma **Arquitetura em Camadas (Layered Architecture)** com separa√ß√£o clara de responsabilidades e uma camada de seguran√ßa integrada:

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    Presentation Layer                       ‚îÇ
‚îÇ                    (Controllers)                           ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                    Security Layer                          ‚îÇ
‚îÇ                    (JWT, Spring Security)                  ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                    Business Layer                          ‚îÇ
‚îÇ                    (Services)                              ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                    Data Access Layer                       ‚îÇ
‚îÇ                    (Cache, Utils, Repository)              ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                    Infrastructure Layer                     ‚îÇ
‚îÇ                    (Config, Redis, H2 Database)            ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### **1.2 Princ√≠pios de Design**

- **Separation of Concerns**: Cada camada tem responsabilidade espec√≠fica
- **Dependency Inversion**: Depend√™ncias injetadas, n√£o criadas
- **Single Responsibility**: Cada classe tem uma √∫nica responsabilidade
- **Open/Closed Principle**: Extens√≠vel sem modifica√ß√£o
- **Security by Design**: Seguran√ßa integrada em todas as camadas

---

## üîê **Arquitetura de Seguran√ßa JWT**

### **2.1 Vis√£o Geral da Seguran√ßa**

A aplica√ß√£o implementa um sistema de seguran√ßa robusto baseado em JWT (JSON Web Tokens) com Spring Security:

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    Cliente                                 ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                    Spring Security                         ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ   Auth Filter   ‚îÇ           Security Config                ‚îÇ
‚îÇ   (JWT)        ‚îÇ           (Roles & Permissions)          ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                    Controllers                             ‚îÇ
‚îÇ              (Protegidos por Roles)                       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### **2.2 Componentes de Seguran√ßa**

#### **JwtAuthenticationFilter**
```java
@Component
@RequiredArgsConstructor
public class JwtAuthenticationFilter extends OncePerRequestFilter {
    
    @Override
    protected void doFilterInternal(HttpServletRequest request, 
                                  HttpServletResponse response, 
                                  FilterChain filterChain) {
        // 1. Extrair token do header Authorization
        // 2. Validar token JWT
        // 3. Configurar contexto de seguran√ßa
        // 4. Passar para pr√≥ximo filtro
    }
}
```

#### **SecurityConfig**
```java
@Configuration
@EnableWebSecurity
@EnableMethodSecurity
public class SecurityConfig {
    
    @Bean
    public SecurityFilterChain securityFilterChain(HttpSecurity http) {
        return http
            .csrf(AbstractHttpConfigurer::disable)
            .authorizeHttpRequests(auth -> auth
                .requestMatchers("/api/auth/**").permitAll()
                .requestMatchers("/h2-console/**").permitAll()
                .requestMatchers("/api/anagrams/health").permitAll()
                .anyRequest().authenticated()
            )
            .sessionManagement(session -> session
                .sessionCreationPolicy(SessionCreationPolicy.STATELESS)
            )
            .authenticationProvider(authenticationProvider())
            .addFilterBefore(jwtAuthFilter, UsernamePasswordAuthenticationFilter.class)
            .build();
    }
}
```

### **2.3 Fluxo de Autentica√ß√£o**

```
1. Cliente ‚Üí POST /api/auth/login (credenciais)
2. AuthService ‚Üí Valida credenciais
3. JwtService ‚Üí Gera token JWT
4. Cliente ‚Üí Armazena token
5. Cliente ‚Üí Inclui token no header Authorization
6. JwtAuthenticationFilter ‚Üí Valida token
7. SecurityContext ‚Üí Configura autentica√ß√£o
8. Controller ‚Üí Processa requisi√ß√£o
```

### **2.4 Controle de Acesso por Role**

#### **Anota√ß√µes de Seguran√ßa**
```java
@RestController
@RequestMapping("/api/anagrams")
public class AnagramController {
    
    @PostMapping("/generate")
    @PreAuthorize("hasRole('USER') or hasRole('ADMIN')")
    public ResponseEntity<AnagramResponse> generateAnagrams(...) {
        // Acesso para usu√°rios autenticados
    }
    
    @DeleteMapping("/cache")
    @PreAuthorize("hasRole('ADMIN')")
    public ResponseEntity<Map<String, String>> clearCache(...) {
        // Acesso apenas para administradores
    }
}
```

#### **Mapeamento de Roles**
- **USER**: Acesso b√°sico aos endpoints de anagramas
- **ADMIN**: Acesso total, incluindo gerenciamento de cache

---

## üß© **Padr√µes de Projeto Implementados**

### **3.1 Padr√£o MVC (Model-View-Controller)**

#### **Implementa√ß√£o:**
```java
@RestController
@RequestMapping("/api/anagrams")
public class AnagramController {
    
    @Autowired
    private AnagramService anagramService;
    
    @PostMapping("/generate")
    @PreAuthorize("hasRole('USER') or hasRole('ADMIN')")
    public ResponseEntity<AnagramResponse> generateAnagrams(
        @Valid @RequestBody AnagramRequest request) {
        // Controller: Gerencia requisi√ß√µes HTTP
        // Model: AnagramRequest/AnagramResponse (DTOs)
        // View: Resposta JSON
    }
}
```

#### **Benef√≠cios:**
- **Separa√ß√£o clara** entre l√≥gica de apresenta√ß√£o e neg√≥cio
- **Testabilidade** melhorada com componentes isolados
- **Manutenibilidade** com responsabilidades bem definidas
- **Seguran√ßa integrada** com controle de acesso por role

### **3.2 Padr√£o Service Layer**

#### **Implementa√ß√£o:**
```java
@Service
@Slf4j
public class AnagramService {
    
    @Autowired
    private RedisCacheService cacheService;
    
    @Autowired
    private AnagramGenerator generator;
    
    public AnagramResponse generateAnagrams(String letters) {
        // Orquestra√ß√£o de opera√ß√µes
        // L√≥gica de neg√≥cio centralizada
        // Coordena√ß√£o entre diferentes componentes
    }
}
```

#### **Caracter√≠sticas:**
- **Orchestration**: Coordena diferentes componentes
- **Business Logic**: Centraliza regras de neg√≥cio
- **Transaction Management**: Gerencia transa√ß√µes
- **Logging**: Logs estruturados para monitoramento

### **3.3 Padr√£o Repository (Cache)**

#### **Implementa√ß√£o:**
```java
@Service
@Slf4j
public class RedisCacheService {
    
    @Autowired
    private RedisTemplate<String, Object> redisTemplate;
    
    public void saveAnagrams(String letters, AnagramResponse response) {
        // Abstra√ß√£o de acesso a dados
        // Interface consistente para cache
        // Fallback para cache em mem√≥ria
    }
}
```

### **3.4 Padr√£o DTO (Data Transfer Object)**

#### **Implementa√ß√£o:**
```java
@Data
@NoArgsConstructor
@AllArgsConstructor
public class AuthRequest {
    
    @NotBlank(message = "Username √© obrigat√≥rio")
    private String username;
    
    @NotBlank(message = "Password √© obrigat√≥rio")
    private String password;
}

@Data
@NoArgsConstructor
@AllArgsConstructor
public class AuthResponse {
    private String token;
    private String type = "Bearer";
    private String username;
    private String role;
    private String message;
}
```

#### **Benef√≠cios:**
- **Valida√ß√£o**: Anota√ß√µes Bean Validation
- **Serializa√ß√£o**: JSON autom√°tico
- **Seguran√ßa**: N√£o exp√µe entidades internas
- **Versioning**: Controle de vers√£o da API

---

## üóÑÔ∏è **Arquitetura de Dados**

### **4.1 Banco de Dados H2**

#### **Configura√ß√£o:**
```properties
# H2 Database
spring.datasource.url=jdbc:h2:mem:text_processing_db
spring.datasource.username=sa
spring.datasource.password=password
spring.h2.console.enabled=true
spring.h2.console.path=/h2-console

# JPA
spring.jpa.database-platform=org.hibernate.dialect.H2Dialect
spring.jpa.hibernate.ddl-auto=create-drop
spring.jpa.show-sql=true
```

#### **Entidade User:**
```java
@Entity
@Table(name = "users")
@Data
@NoArgsConstructor
@AllArgsConstructor
public class User implements UserDetails {
    
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    
    @Column(unique = true, nullable = false)
    private String username;
    
    @Column(nullable = false)
    private String password;
    
    @Column(nullable = false)
    private String email;
    
    @Column(name = "full_name")
    private String fullName;
    
    @Column(name = "is_active")
    private boolean isActive = true;
    
    @Column(name = "role")
    private String role = "USER";
    
    @Override
    public Collection<? extends GrantedAuthority> getAuthorities() {
        return List.of(new SimpleGrantedAuthority("ROLE_" + role));
    }
}
```

#### **UserRepository:**
```java
@Repository
public interface UserRepository extends JpaRepository<User, Long> {
    
    Optional<User> findByUsername(String username);
    boolean existsByUsername(String username);
    boolean existsByEmail(String email);
}
```

### **4.2 Cache Redis**

#### **Configura√ß√£o:**
```properties
# Redis
spring.redis.host=localhost
spring.redis.port=6379
spring.redis.timeout=2000ms

# Cache
app.anagram.cache.enabled=true
app.anagram.cache.ttl=3600
```

#### **Estrat√©gia de Cache:**
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    AnagramService                          ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                    RedisCacheService                       ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ   Redis Cache   ‚îÇ           Memory Cache                   ‚îÇ
‚îÇ   (Prim√°rio)    ‚îÇ           (Fallback)                     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üîß **Configura√ß√µes de Seguran√ßa**

### **5.1 JWT Configuration**

#### **Properties:**
```properties
# JWT
jwt.secret=text-processing-api-secret-key-2024-very-long-and-secure-key-for-jwt-signing
jwt.expiration=86400000
```

#### **JwtService:**
```java
@Service
@Slf4j
public class JwtService {
    
    @Value("${jwt.secret}")
    private String secret;
    
    @Value("${jwt.expiration}")
    private Long expiration;
    
    public String generateToken(UserDetails userDetails) {
        SecretKey key = Keys.hmacShaKeyFor(secret.getBytes());
        
        return Jwts.builder()
                .claims(new HashMap<>())
                .subject(userDetails.getUsername())
                .issuedAt(new Date(System.currentTimeMillis()))
                .expiration(new Date(System.currentTimeMillis() + expiration))
                .signWith(key, Jwts.SIG.HS256)
                .compact();
    }
    
    public boolean isTokenValid(String token, UserDetails userDetails) {
        final String username = extractUsername(token);
        return (username.equals(userDetails.getUsername()) && !isTokenExpired(token));
    }
}
```

### **5.2 AuthService**

#### **Implementa√ß√£o:**
```java
@Service
@RequiredArgsConstructor
@Slf4j
public class AuthService implements UserDetailsService {
    
    private final UserRepository userRepository;
    private final PasswordEncoder passwordEncoder;
    private final JwtService jwtService;
    private final AuthenticationManager authenticationManager;
    
    public AuthResponse authenticate(AuthRequest request) {
        Authentication authentication = authenticationManager.authenticate(
            new UsernamePasswordAuthenticationToken(
                request.getUsername(),
                request.getPassword()
            )
        );
        
        UserDetails userDetails = (UserDetails) authentication.getPrincipal();
        String token = jwtService.generateToken(userDetails);
        
        User user = userRepository.findByUsername(userDetails.getUsername())
                .orElseThrow(() -> new UsernameNotFoundException("Usu√°rio n√£o encontrado"));
        
        return new AuthResponse(token, user.getUsername(), user.getRole());
    }
    
    @Override
    public UserDetails loadUserByUsername(String username) throws UsernameNotFoundException {
        return userRepository.findByUsername(username)
                .orElseThrow(() -> new UsernameNotFoundException("Usu√°rio n√£o encontrado: " + username));
    }
}
```

---

## üß™ **Arquitetura de Testes**

### **6.1 Testes Unit√°rios**

#### **Estrutura:**
```
src/test/java/
‚îú‚îÄ‚îÄ controller/
‚îÇ   ‚îú‚îÄ‚îÄ AnagramControllerTest.java
‚îÇ   ‚îî‚îÄ‚îÄ AuthControllerTest.java
‚îú‚îÄ‚îÄ service/
‚îÇ   ‚îú‚îÄ‚îÄ AnagramServiceTest.java
‚îÇ   ‚îú‚îÄ‚îÄ AuthServiceTest.java
‚îÇ   ‚îî‚îÄ‚îÄ JwtServiceTest.java
‚îî‚îÄ‚îÄ util/
    ‚îî‚îÄ‚îÄ AnagramGeneratorTest.java
```

#### **Testes de Seguran√ßa:**
```java
@ExtendWith(MockitoExtension.class)
class AnagramControllerTest {
    
    @Test
    @DisplayName("Deve retornar erro 401 para usu√°rio n√£o autenticado")
    void shouldReturnUnauthorizedForUnauthenticatedUser() throws Exception {
        AnagramRequest request = new AnagramRequest();
        request.setLetters("abc");
        
        mockMvc.perform(post("/api/anagrams/generate")
                .contentType(MediaType.APPLICATION_JSON)
                .content(objectMapper.writeValueAsString(request)))
                .andExpect(status().isUnauthorized());
    }
    
    @Test
    @DisplayName("Deve permitir acesso ao endpoint health sem autentica√ß√£o")
    @WithMockUser(roles = "USER")
    void shouldAllowHealthEndpointWithoutAuthentication() throws Exception {
        mockMvc.perform(get("/api/anagrams/health"))
                .andExpect(status().isOk());
    }
}
```

### **6.2 Testes de Integra√ß√£o**

#### **Testes Java com JUnit 5:**
- **AnagramApiIntegrationTest**: Testes HTTP reais com TestRestTemplate
- **RedisIntegrationTest**: Testes de integra√ß√£o com Redis Embedded

#### **Caracter√≠sticas dos Testes:**
- **Redis Embedded**: Funciona sem instala√ß√£o externa
- **Autentica√ß√£o Real**: Login JWT real em cada teste
- **HTTP Real**: TestRestTemplate para requisi√ß√µes HTTP completas
- **Spring Security**: Seguran√ßa ativa durante testes
- **Perfil de Teste**: Configura√ß√£o espec√≠fica para testes

#### **Cobertura:**
- ‚úÖ **Autentica√ß√£o JWT**: Login e valida√ß√£o de tokens
- ‚úÖ **Controle de Acesso**: Verifica√ß√£o de roles e permiss√µes
- ‚úÖ **Cache Hit/Miss**: Verifica√ß√£o de comportamento
- ‚úÖ **Cache Inteligente**: Reutiliza√ß√£o de composi√ß√µes
- ‚úÖ **Valida√ß√£o de Entrada**: Tratamento de erros
- ‚úÖ **Performance**: Tempos de resposta
- ‚úÖ **Gerenciamento**: Limpeza e status do cache
- ‚úÖ **Redis Embedded**: Funcionamento sem depend√™ncias externas
- ‚úÖ **HTTP Real**: TestRestTemplate com Spring Security ativo
- ‚úÖ **Cen√°rios de Carga**: M√∫ltiplas requisi√ß√µes simult√¢neas

---

## üìä **Monitoramento e Logs**

### **7.1 Logs de Seguran√ßa**

#### **Configura√ß√£o:**
```properties
# Logging
logging.level.com.lucas.text_processing_api=DEBUG
logging.level.org.springframework.security=DEBUG
```

#### **Exemplos de Logs:**
```
INFO  - Tentativa de autentica√ß√£o para usu√°rio: admin
INFO  - Autentica√ß√£o bem-sucedida para usu√°rio: admin
DEBUG - Usu√°rio autenticado via JWT: admin
WARN  - Token JWT inv√°lido para usu√°rio: user
ERROR - Erro na autentica√ß√£o para usu√°rio: invalid_user
```

### **7.2 M√©tricas de Seguran√ßa**

- **Login Rate**: Tentativas de login por minuto
- **Token Validation**: Taxa de valida√ß√£o de tokens
- **Access Control**: Tentativas de acesso negado
- **Role Usage**: Distribui√ß√£o de uso por role

---

## üöÄ **Deploy e Configura√ß√£o**

### **8.1 Configura√ß√µes de Produ√ß√£o**

#### **JWT Secret:**
```properties
# PRODU√á√ÉO: Alterar para chave segura e √∫nica
jwt.secret=${JWT_SECRET:your-production-secret-key-here}
jwt.expiration=${JWT_EXPIRATION:86400000}
```

#### **Banco de Dados:**
```properties
# PRODU√á√ÉO: Usar banco persistente (PostgreSQL, MySQL)
spring.datasource.url=${DATABASE_URL:jdbc:postgresql://localhost:5432/text_processing}
spring.datasource.username=${DATABASE_USERNAME:app_user}
spring.datasource.password=${DATABASE_PASSWORD:secure_password}
```

#### **Redis:**
```properties
# PRODU√á√ÉO: Configurar Redis externo
spring.redis.host=${REDIS_HOST:redis.example.com}
spring.redis.port=${REDIS_PORT:6379}
spring.redis.password=${REDIS_PASSWORD:secure_redis_password}
```

### **8.2 Vari√°veis de Ambiente**

#### **Seguran√ßa:**
```bash
export JWT_SECRET="your-super-secure-jwt-secret-key-2024"
export JWT_EXPIRATION="86400000"
```

#### **Banco de Dados:**
```bash
export DATABASE_URL="jdbc:postgresql://localhost:5432/text_processing"
export DATABASE_USERNAME="app_user"
export DATABASE_PASSWORD="secure_password"
```

#### **Redis:**
```bash
export REDIS_HOST="redis.example.com"
export REDIS_PORT="6379"
export REDIS_PASSWORD="secure_redis_password"
```

---

## üîÆ **Roadmap e Melhorias Futuras**

### **9.1 Seguran√ßa**

- [ ] **Refresh Tokens**: Renova√ß√£o autom√°tica de tokens
- [ ] **OAuth2**: Integra√ß√£o com provedores externos (Google, GitHub)
- [ ] **Rate Limiting**: Prote√ß√£o contra abuso e ataques
- [ ] **Audit Logs**: Logs detalhados de acesso e uso
- [ ] **Multi-factor Authentication**: 2FA para usu√°rios cr√≠ticos

### **9.2 Performance**

- [ ] **Cache Distribu√≠do**: Redis Cluster para alta disponibilidade
- [ ] **Compress√£o**: Compress√£o de dados no cache
- [ ] **M√©tricas Avan√ßadas**: Prometheus + Grafana
- [ ] **Load Balancing**: Distribui√ß√£o de carga

### **9.3 Funcionalidades**

- [ ] **Machine Learning**: Sugest√µes de palavras similares
- [ ] **API GraphQL**: Consultas flex√≠veis
- [ ] **WebSocket**: Notifica√ß√µes em tempo real
- [ ] **Multi-idioma**: Suporte a diferentes alfabetos

---

## üìö **Refer√™ncias e Recursos**

### **10.1 Documenta√ß√£o Oficial**

- **Spring Security**: https://docs.spring.io/spring-security/reference/
- **JWT**: https://jwt.io/introduction
- **Spring Boot**: https://spring.io/projects/spring-boot
- **H2 Database**: http://www.h2database.com/html/main.html

### **10.2 Padr√µes de Seguran√ßa**

- **OWASP Top 10**: https://owasp.org/www-project-top-ten/
- **JWT Best Practices**: https://auth0.com/blog/a-look-at-the-latest-draft-for-jwt-bcp/
- **Spring Security Best Practices**: https://spring.io/guides/topicals/spring-security-architecture/

### **10.3 Ferramentas de Teste**

- **Postman**: Testes de API
- **JUnit 5**: Framework de testes
- **Mockito**: Mocking framework
- **Spring Security Test**: Testes de seguran√ßa
- **TestRestTemplate**: Testes de integra√ß√£o HTTP reais
- **Redis Embedded**: Testes sem depend√™ncias externas
- **Spring Boot Test**: Configura√ß√£o de testes integrados

---

## üéØ **Conclus√£o**

A Text Processing API implementa uma arquitetura robusta e segura com:

- **Seguran√ßa JWT integrada** com Spring Security
- **Controle de acesso por roles** (USER/ADMIN)
- **Banco de dados H2** para usu√°rios de teste
- **Cache Redis inteligente** com fallback
- **Testes automatizados** para todas as funcionalidades
- **Testes de integra√ß√£o** com Redis Embedded e HTTP real
- **Documenta√ß√£o completa** para desenvolvedores

A arquitetura segue princ√≠pios SOLID e padr√µes de projeto estabelecidos, garantindo:

- **Manutenibilidade**: C√≥digo bem estruturado e documentado
- **Testabilidade**: Componentes isolados e test√°veis
- **Escalabilidade**: Preparado para crescimento futuro
- **Seguran√ßa**: Prote√ß√£o robusta contra ataques comuns

**üöÄ A API est√° pronta para uso com seguran√ßa JWT e testes robustos!** üîê‚ú®üß™
